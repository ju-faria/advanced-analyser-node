(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
  typeof define === 'function' && define.amd ? define(['exports'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.advancedAnalyserNode = {}));
})(this, (function (exports) { 'use strict';

  var MessageTypes;
  (function (MessageTypes) {
      MessageTypes["start"] = "start";
      MessageTypes["stop"] = "stop";
      MessageTypes["dataAvailable"] = "data-available";
  })(MessageTypes || (MessageTypes = {}));
  var ProcessorParameters;
  (function (ProcessorParameters) {
      ProcessorParameters["fftSize"] = "fftSize";
      ProcessorParameters["samplesBetweenTransforms"] = "samplesBetweenTransforms";
  })(ProcessorParameters || (ProcessorParameters = {}));

  var processor = "IWZ1bmN0aW9uKHQpeyJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKHQpOnQoKX0oKGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQodCl7aWYodGhpcy5zaXplPTB8dCx0aGlzLnNpemU8PTF8fDAhPSh0aGlzLnNpemUmdGhpcy5zaXplLTEpKXRocm93IG5ldyBFcnJvcigiRkZUIHNpemUgbXVzdCBiZSBhIHBvd2VyIG9mIHR3byBhbmQgYmlnZ2VyIHRoYW4gMSIpO3RoaXMuX2NzaXplPXQ8PDE7Zm9yKHZhciBzPW5ldyBBcnJheSgyKnRoaXMuc2l6ZSkscj0wO3I8cy5sZW5ndGg7cis9Mil7Y29uc3QgdD1NYXRoLlBJKnIvdGhpcy5zaXplO3Nbcl09TWF0aC5jb3ModCksc1tyKzFdPS1NYXRoLnNpbih0KX10aGlzLnRhYmxlPXM7Zm9yKHZhciBlPTAsaT0xO3RoaXMuc2l6ZT5pO2k8PD0xKWUrKzt0aGlzLl93aWR0aD1lJTI9PTA/ZS0xOmUsdGhpcy5fYml0cmV2PW5ldyBBcnJheSgxPDx0aGlzLl93aWR0aCk7Zm9yKHZhciBvPTA7bzx0aGlzLl9iaXRyZXYubGVuZ3RoO28rKyl7dGhpcy5fYml0cmV2W29dPTA7Zm9yKHZhciBuPTA7bjx0aGlzLl93aWR0aDtuKz0yKXt2YXIgYT10aGlzLl93aWR0aC1uLTI7dGhpcy5fYml0cmV2W29dfD0obz4+Pm4mMyk8PGF9fXRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbCx0aGlzLl9pbnY9MH12YXIgcyxyLGU9dDt0LnByb3RvdHlwZS5mcm9tQ29tcGxleEFycmF5PWZ1bmN0aW9uKHQscyl7Zm9yKHZhciByPXN8fG5ldyBBcnJheSh0Lmxlbmd0aD4+PjEpLGU9MDtlPHQubGVuZ3RoO2UrPTIpcltlPj4+MV09dFtlXTtyZXR1cm4gcn0sdC5wcm90b3R5cGUuY3JlYXRlQ29tcGxleEFycmF5PWZ1bmN0aW9uKCl7Y29uc3QgdD1uZXcgQXJyYXkodGhpcy5fY3NpemUpO2Zvcih2YXIgcz0wO3M8dC5sZW5ndGg7cysrKXRbc109MDtyZXR1cm4gdH0sdC5wcm90b3R5cGUudG9Db21wbGV4QXJyYXk9ZnVuY3Rpb24odCxzKXtmb3IodmFyIHI9c3x8dGhpcy5jcmVhdGVDb21wbGV4QXJyYXkoKSxlPTA7ZTxyLmxlbmd0aDtlKz0yKXJbZV09dFtlPj4+MV0scltlKzFdPTA7cmV0dXJuIHJ9LHQucHJvdG90eXBlLmNvbXBsZXRlU3BlY3RydW09ZnVuY3Rpb24odCl7Zm9yKHZhciBzPXRoaXMuX2NzaXplLHI9cz4+PjEsZT0yO2U8cjtlKz0yKXRbcy1lXT10W2VdLHRbcy1lKzFdPS10W2UrMV19LHQucHJvdG90eXBlLnRyYW5zZm9ybT1mdW5jdGlvbih0LHMpe2lmKHQ9PT1zKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1zLHRoaXMuX2ludj0wLHRoaXMuX3RyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9LHQucHJvdG90eXBlLnJlYWxUcmFuc2Zvcm09ZnVuY3Rpb24odCxzKXtpZih0PT09cyl0aHJvdyBuZXcgRXJyb3IoIklucHV0IGFuZCBvdXRwdXQgYnVmZmVycyBtdXN0IGJlIGRpZmZlcmVudCIpO3RoaXMuX291dD10LHRoaXMuX2RhdGE9cyx0aGlzLl9pbnY9MCx0aGlzLl9yZWFsVHJhbnNmb3JtNCgpLHRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH0sdC5wcm90b3R5cGUuaW52ZXJzZVRyYW5zZm9ybT1mdW5jdGlvbih0LHMpe2lmKHQ9PT1zKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1zLHRoaXMuX2ludj0xLHRoaXMuX3RyYW5zZm9ybTQoKTtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKyl0W3JdLz10aGlzLnNpemU7dGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfSx0LnByb3RvdHlwZS5fdHJhbnNmb3JtND1mdW5jdGlvbigpe3ZhciB0LHMscj10aGlzLl9vdXQsZT10aGlzLl9jc2l6ZSxpPTE8PHRoaXMuX3dpZHRoLG89ZS9pPDwxLG49dGhpcy5fYml0cmV2O2lmKDQ9PT1vKWZvcih0PTAscz0wO3Q8ZTt0Kz1vLHMrKyl7Y29uc3Qgcj1uW3NdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTIodCxyLGkpfWVsc2UgZm9yKHQ9MCxzPTA7dDxlO3QrPW8scysrKXtjb25zdCByPW5bc107dGhpcy5fc2luZ2xlVHJhbnNmb3JtNCh0LHIsaSl9dmFyIGE9dGhpcy5faW52Py0xOjEsZj10aGlzLnRhYmxlO2ZvcihpPj49MjtpPj0yO2k+Pj0yKXt2YXIgaD0obz1lL2k8PDEpPj4+Mjtmb3IodD0wO3Q8ZTt0Kz1vKWZvcih2YXIgXz10K2gsbD10LHU9MDtsPF87bCs9Mix1Kz1pKXtjb25zdCB0PWwscz10K2gsZT1zK2gsaT1lK2gsbz1yW3RdLG49clt0KzFdLF89cltzXSxwPXJbcysxXSxtPXJbZV0sYz1yW2UrMV0sZD1yW2ldLHY9cltpKzFdLHk9byxUPW4sdz1mW3VdLGc9YSpmW3UrMV0sYj1fKnctcCpnLEE9XypnK3Aqdyx6PWZbMip1XSxCPWEqZlsyKnUrMV0sUz1tKnotYypCLEM9bSpCK2MqeixNPWZbMyp1XSx4PWEqZlszKnUrMV0sRT1kKk0tdip4LEY9ZCp4K3YqTSxPPXkrUyxSPVQrQyxJPXktUyxQPVQtQyxrPWIrRSxEPUErRixVPWEqKGItRSksVj1hKihBLUYpLFc9TytrLGo9UitELHE9Ty1rLEc9Ui1ELEg9SStWLEo9UC1VLEs9SS1WLEw9UCtVO3JbdF09VyxyW3QrMV09aixyW3NdPUgscltzKzFdPUoscltlXT1xLHJbZSsxXT1HLHJbaV09SyxyW2krMV09TH19fSx0LnByb3RvdHlwZS5fc2luZ2xlVHJhbnNmb3JtMj1mdW5jdGlvbih0LHMscil7Y29uc3QgZT10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtzXSxuPWlbcysxXSxhPWlbcytyXSxmPWlbcytyKzFdLGg9bythLF89bitmLGw9by1hLHU9bi1mO2VbdF09aCxlW3QrMV09XyxlW3QrMl09bCxlW3QrM109dX0sdC5wcm90b3R5cGUuX3NpbmdsZVRyYW5zZm9ybTQ9ZnVuY3Rpb24odCxzLHIpe2NvbnN0IGU9dGhpcy5fb3V0LGk9dGhpcy5fZGF0YSxvPXRoaXMuX2ludj8tMToxLG49MipyLGE9MypyLGY9aVtzXSxoPWlbcysxXSxfPWlbcytyXSxsPWlbcytyKzFdLHU9aVtzK25dLHA9aVtzK24rMV0sbT1pW3MrYV0sYz1pW3MrYSsxXSxkPWYrdSx2PWgrcCx5PWYtdSxUPWgtcCx3PV8rbSxnPWwrYyxiPW8qKF8tbSksQT1vKihsLWMpLHo9ZCt3LEI9ditnLFM9eStBLEM9VC1iLE09ZC13LHg9di1nLEU9eS1BLEY9VCtiO2VbdF09eixlW3QrMV09QixlW3QrMl09UyxlW3QrM109QyxlW3QrNF09TSxlW3QrNV09eCxlW3QrNl09RSxlW3QrN109Rn0sdC5wcm90b3R5cGUuX3JlYWxUcmFuc2Zvcm00PWZ1bmN0aW9uKCl7dmFyIHQscyxyPXRoaXMuX291dCxlPXRoaXMuX2NzaXplLGk9MTw8dGhpcy5fd2lkdGgsbz1lL2k8PDEsbj10aGlzLl9iaXRyZXY7aWYoND09PW8pZm9yKHQ9MCxzPTA7dDxlO3QrPW8scysrKXtjb25zdCByPW5bc107dGhpcy5fc2luZ2xlUmVhbFRyYW5zZm9ybTIodCxyPj4+MSxpPj4+MSl9ZWxzZSBmb3IodD0wLHM9MDt0PGU7dCs9byxzKyspe2NvbnN0IHI9bltzXTt0aGlzLl9zaW5nbGVSZWFsVHJhbnNmb3JtNCh0LHI+Pj4xLGk+Pj4xKX12YXIgYT10aGlzLl9pbnY/LTE6MSxmPXRoaXMudGFibGU7Zm9yKGk+Pj0yO2k+PTI7aT4+PTIpe3ZhciBoPShvPWUvaTw8MSk+Pj4xLF89aD4+PjEsbD1fPj4+MTtmb3IodD0wO3Q8ZTt0Kz1vKWZvcih2YXIgdT0wLHA9MDt1PD1sO3UrPTIscCs9aSl7dmFyIG09dCt1LGM9bStfLGQ9YytfLHY9ZCtfLHk9clttXSxUPXJbbSsxXSx3PXJbY10sZz1yW2MrMV0sYj1yW2RdLEE9cltkKzFdLHo9clt2XSxCPXJbdisxXSxTPXksQz1ULE09ZltwXSx4PWEqZltwKzFdLEU9dypNLWcqeCxGPXcqeCtnKk0sTz1mWzIqcF0sUj1hKmZbMipwKzFdLEk9YipPLUEqUixQPWIqUitBKk8saz1mWzMqcF0sRD1hKmZbMypwKzFdLFU9eiprLUIqRCxWPXoqRCtCKmssVz1TK0ksaj1DK1AscT1TLUksRz1DLVAsSD1FK1UsSj1GK1YsSz1hKihFLVUpLEw9YSooRi1WKSxOPVcrSCxRPWorSixYPXErTCxZPUctSztpZihyW21dPU4sclttKzFdPVEscltjXT1YLHJbYysxXT1ZLDAhPT11KXtpZih1IT09bCl7dmFyIFo9cSstYSpMLCQ9LUcrLWEqSyx0dD1XKy1hKkgsc3Q9LWotIC1hKkoscnQ9dCtfLXUsZXQ9dCtoLXU7cltydF09WixyW3J0KzFdPSQscltldF09dHQscltldCsxXT1zdH19ZWxzZXt2YXIgaXQ9Vy1ILG90PWotSjtyW2RdPWl0LHJbZCsxXT1vdH19fX0sdC5wcm90b3R5cGUuX3NpbmdsZVJlYWxUcmFuc2Zvcm0yPWZ1bmN0aW9uKHQscyxyKXtjb25zdCBlPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz1pW3NdLG49aVtzK3JdLGE9bytuLGY9by1uO2VbdF09YSxlW3QrMV09MCxlW3QrMl09ZixlW3QrM109MH0sdC5wcm90b3R5cGUuX3NpbmdsZVJlYWxUcmFuc2Zvcm00PWZ1bmN0aW9uKHQscyxyKXtjb25zdCBlPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz10aGlzLl9pbnY/LTE6MSxuPTIqcixhPTMqcixmPWlbc10saD1pW3Mrcl0sXz1pW3Mrbl0sbD1pW3MrYV0sdT1mK18scD1mLV8sbT1oK2wsYz1vKihoLWwpLGQ9dSttLHY9cCx5PS1jLFQ9dS1tLHc9cCxnPWM7ZVt0XT1kLGVbdCsxXT0wLGVbdCsyXT12LGVbdCszXT15LGVbdCs0XT1ULGVbdCs1XT0wLGVbdCs2XT13LGVbdCs3XT1nfSxmdW5jdGlvbih0KXt0LnN0YXJ0PSJzdGFydCIsdC5zdG9wPSJzdG9wIix0LmRhdGFBdmFpbGFibGU9ImRhdGEtYXZhaWxhYmxlIn0oc3x8KHM9e30pKSxmdW5jdGlvbih0KXt0LmZmdFNpemU9ImZmdFNpemUiLHQuc2FtcGxlc0JldHdlZW5UcmFuc2Zvcm1zPSJzYW1wbGVzQmV0d2VlblRyYW5zZm9ybXMifShyfHwocj17fSkpO2NvbnN0IGk9dD0+e2NvbnN0IHM9MjU1Kih0LSAtMTAwKSouMDE0Mjg1NzE0Mjg1NzE0Mjg1O3JldHVybiBNYXRoLm1heCgwfHMsMCl9O2NsYXNzIG8gZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7X3NhbXBsZXNDb3VudD0wO19jb3VudD0wO19maXJzdD0hMDtfZmZ0QW5hbHlzZXI7X2ZmdFNpemU7X2ZmdE91dHB1dDtfbGFzdFRyYW5zZm9ybTtfbGFzdFRyYW5zZm9ybUFzQnl0ZXM7X3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3JtcztfYnVmZmVyO3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImlzUmVjb3JkaW5nIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHQpe3N1cGVyKCk7Y29uc3R7ZmZ0U2l6ZTpzLHNhbXBsZXNCZXR3ZWVuVHJhbnNmb3JtczpyfT10LnByb2Nlc3Nvck9wdGlvbnM7dGhpcy5fZmZ0QW5hbHlzZXI9bmV3IGUocyksdGhpcy5fZmZ0T3V0cHV0PXRoaXMuX2ZmdEFuYWx5c2VyLmNyZWF0ZUNvbXBsZXhBcnJheSgpLHRoaXMuX2xhc3RUcmFuc2Zvcm09bmV3IEZsb2F0MzJBcnJheShzLzIpLHRoaXMuX2xhc3RUcmFuc2Zvcm1Bc0J5dGVzPW5ldyBVaW50OEFycmF5KHMvMiksdGhpcy5fZmZ0U2l6ZT1zLHRoaXMuX3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3Jtcz1yLHRoaXMuX2J1ZmZlcj1uZXcgRmxvYXQzMkFycmF5KHRoaXMuX2ZmdFNpemUpLHRoaXMuX2luaXRCdWZmZXIoKX1faW5pdEJ1ZmZlcigpe2ZvcihsZXQgdD10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXM7dDx0aGlzLl9mZnRTaXplO3QrKyl0aGlzLl9idWZmZXJbdC10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXNdPXRoaXMuX2J1ZmZlclt0XTt0aGlzLl9zYW1wbGVzQ291bnQ9MH1faXNCdWZmZXJFbXB0eSgpe3JldHVybiAwPT09dGhpcy5fc2FtcGxlc0NvdW50fV9zaG91bGRUcmFuc2Zvcm1TYW1wbGVzKCl7cmV0dXJuIHRoaXMuX3NhbXBsZXNDb3VudD09PXRoaXMuX3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3Jtc31fYXBwZW5kVG9CdWZmZXIodCl7dGhpcy5fc2hvdWxkVHJhbnNmb3JtU2FtcGxlcygpJiZ0aGlzLl9mbHVzaCgpLHRoaXMuX2J1ZmZlclt0aGlzLl9mZnRTaXplLXRoaXMuX3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3Jtcyt0aGlzLl9zYW1wbGVzQ291bnRdPXQsdGhpcy5fc2FtcGxlc0NvdW50Kz0xfV9kb0ZmdCgpe2xldCB0PXRoaXMuX2J1ZmZlcjt0aGlzLl9zYW1wbGVzQ291bnQ8dGhpcy5fc2FtcGxlc0JldHdlZW5UcmFuc2Zvcm1zJiYodD10LnNsaWNlKDAsdGhpcy5fZmZ0U2l6ZS10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXMrdGhpcy5fc2FtcGxlc0NvdW50KSksdGhpcy5fZmZ0QW5hbHlzZXIucmVhbFRyYW5zZm9ybSh0aGlzLl9mZnRPdXRwdXQsdCk7Y29uc3Qgcz0xL3RoaXMuX2ZmdFNpemU7Zm9yKGxldCB0PTA7dDx0aGlzLl9sYXN0VHJhbnNmb3JtLmxlbmd0aDt0Kyspe2NvbnN0IGU9KHI9TWF0aC5hYnMoTWF0aC5oeXBvdCh0aGlzLl9mZnRPdXRwdXRbMip0XSx0aGlzLl9mZnRPdXRwdXRbMip0KzFdKSkqcywyMCpNYXRoLmxvZzEwKHIpKTt0aGlzLl9sYXN0VHJhbnNmb3JtW3RdPWUsdGhpcy5fbGFzdFRyYW5zZm9ybUFzQnl0ZXNbdF09aShlKX12YXIgcn1fZmx1c2goKXt0aGlzLl9kb0ZmdCgpLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZTpzLmRhdGFBdmFpbGFibGUsY3VycmVudFRpbWU6Y3VycmVudFRpbWUsZGF0YTp0aGlzLl9sYXN0VHJhbnNmb3JtQXNCeXRlc30pLHRoaXMuX2luaXRCdWZmZXIoKX1fcmVjb3JkaW5nU3RvcHBlZCgpe3RoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZTpzLnN0b3B9KX1wcm9jZXNzKHQscyxyKXtjb25zdCBlPXIuaXNSZWNvcmRpbmc7Zm9yKGxldCBzPTA7czx0Lmxlbmd0aDtzKyspe2NvbnN0IHI9MT09PWVbc10mJnRbMF1bMF07aWYocnx8dGhpcy5faXNCdWZmZXJFbXB0eSgpfHwodGhpcy5fZmx1c2goKSx0aGlzLl9yZWNvcmRpbmdTdG9wcGVkKCkpLHIpZm9yKGxldCBzPTA7czx0WzBdWzBdLmxlbmd0aDtzKyspdGhpcy5fYXBwZW5kVG9CdWZmZXIodFswXVswXVtzXSl9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJBZHZhbmNlZEFuYWx5c2VyUHJvY2Vzc29yIixvKX0pKTsK";

  class AdvancedAnalyserNode extends AudioWorkletNode {
      onData;
      fftSize;
      samplesBetweenTransforms;
      constructor(context, { onData, fftSize = 1024, samplesBetweenTransforms, }) {
          super(context, 'AdvancedAnalyserProcessor', {
              processorOptions: {
                  [ProcessorParameters.fftSize]: fftSize,
                  [ProcessorParameters.samplesBetweenTransforms]: samplesBetweenTransforms || fftSize
              }
          });
          this.port.onmessage = (event) => this.onmessage(event.data);
          this.onData = onData;
      }
      onprocessorerror = (err) => {
          console.log(`An error from AudioWorkletProcessor.process() occurred: ${err}`);
      };
      onmessage(event) {
          if (event.type === MessageTypes.dataAvailable) {
              this.onData(event.data);
          }
      }
      start() {
          this.parameters.get('isRecording').setValueAtTime(1, this.context.currentTime);
      }
  }
  const createAdvancedAnalyserNode = async (context, options) => {
      const processorUrl = 'data:application/javascript;base64,' + processor;
      await context.audioWorklet.addModule(processorUrl);
      const advancedAnalyser = new AdvancedAnalyserNode(context, {
          ...options,
      });
      return advancedAnalyser;
  };

  exports.AdvancedAnalyserNode = AdvancedAnalyserNode;
  exports.createAdvancedAnalyserNode = createAdvancedAnalyserNode;

  Object.defineProperty(exports, '__esModule', { value: true });

}));
