(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
  typeof define === 'function' && define.amd ? define(['exports'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.advancedAnalyserNode = {}));
})(this, (function (exports) { 'use strict';

  var MessageTypes;
  (function (MessageTypes) {
      MessageTypes["sendWasmModule"] = "send-wasm-module";
      MessageTypes["wasmModuleLoaded"] = "wasm-module-loaded";
      MessageTypes["initFftAnalyser"] = "init-fft-analyser";
      MessageTypes["start"] = "start";
      MessageTypes["stop"] = "stop";
      MessageTypes["dataAvailable"] = "data-available";
  })(MessageTypes || (MessageTypes = {}));

  var processor = "IWZ1bmN0aW9uKHQpeyJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKHQpOnQoKX0oKGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQodCl7aWYodGhpcy5zaXplPTB8dCx0aGlzLnNpemU8PTF8fDAhPSh0aGlzLnNpemUmdGhpcy5zaXplLTEpKXRocm93IG5ldyBFcnJvcigiRkZUIHNpemUgbXVzdCBiZSBhIHBvd2VyIG9mIHR3byBhbmQgYmlnZ2VyIHRoYW4gMSIpO3RoaXMuX2NzaXplPXQ8PDE7Zm9yKHZhciBzPW5ldyBBcnJheSgyKnRoaXMuc2l6ZSkscj0wO3I8cy5sZW5ndGg7cis9Mil7Y29uc3QgdD1NYXRoLlBJKnIvdGhpcy5zaXplO3Nbcl09TWF0aC5jb3ModCksc1tyKzFdPS1NYXRoLnNpbih0KX10aGlzLnRhYmxlPXM7Zm9yKHZhciBlPTAsaT0xO3RoaXMuc2l6ZT5pO2k8PD0xKWUrKzt0aGlzLl93aWR0aD1lJTI9PTA/ZS0xOmUsdGhpcy5fYml0cmV2PW5ldyBBcnJheSgxPDx0aGlzLl93aWR0aCk7Zm9yKHZhciBvPTA7bzx0aGlzLl9iaXRyZXYubGVuZ3RoO28rKyl7dGhpcy5fYml0cmV2W29dPTA7Zm9yKHZhciBuPTA7bjx0aGlzLl93aWR0aDtuKz0yKXt2YXIgYT10aGlzLl93aWR0aC1uLTI7dGhpcy5fYml0cmV2W29dfD0obz4+Pm4mMyk8PGF9fXRoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbCx0aGlzLl9pbnY9MH12YXIgcyxyPXQ7dC5wcm90b3R5cGUuZnJvbUNvbXBsZXhBcnJheT1mdW5jdGlvbih0LHMpe2Zvcih2YXIgcj1zfHxuZXcgQXJyYXkodC5sZW5ndGg+Pj4xKSxlPTA7ZTx0Lmxlbmd0aDtlKz0yKXJbZT4+PjFdPXRbZV07cmV0dXJuIHJ9LHQucHJvdG90eXBlLmNyZWF0ZUNvbXBsZXhBcnJheT1mdW5jdGlvbigpe2NvbnN0IHQ9bmV3IEFycmF5KHRoaXMuX2NzaXplKTtmb3IodmFyIHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdPTA7cmV0dXJuIHR9LHQucHJvdG90eXBlLnRvQ29tcGxleEFycmF5PWZ1bmN0aW9uKHQscyl7Zm9yKHZhciByPXN8fHRoaXMuY3JlYXRlQ29tcGxleEFycmF5KCksZT0wO2U8ci5sZW5ndGg7ZSs9MilyW2VdPXRbZT4+PjFdLHJbZSsxXT0wO3JldHVybiByfSx0LnByb3RvdHlwZS5jb21wbGV0ZVNwZWN0cnVtPWZ1bmN0aW9uKHQpe2Zvcih2YXIgcz10aGlzLl9jc2l6ZSxyPXM+Pj4xLGU9MjtlPHI7ZSs9Mil0W3MtZV09dFtlXSx0W3MtZSsxXT0tdFtlKzFdfSx0LnByb3RvdHlwZS50cmFuc2Zvcm09ZnVuY3Rpb24odCxzKXtpZih0PT09cyl0aHJvdyBuZXcgRXJyb3IoIklucHV0IGFuZCBvdXRwdXQgYnVmZmVycyBtdXN0IGJlIGRpZmZlcmVudCIpO3RoaXMuX291dD10LHRoaXMuX2RhdGE9cyx0aGlzLl9pbnY9MCx0aGlzLl90cmFuc2Zvcm00KCksdGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfSx0LnByb3RvdHlwZS5yZWFsVHJhbnNmb3JtPWZ1bmN0aW9uKHQscyl7aWYodD09PXMpdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBhbmQgb3V0cHV0IGJ1ZmZlcnMgbXVzdCBiZSBkaWZmZXJlbnQiKTt0aGlzLl9vdXQ9dCx0aGlzLl9kYXRhPXMsdGhpcy5faW52PTAsdGhpcy5fcmVhbFRyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9LHQucHJvdG90eXBlLmludmVyc2VUcmFuc2Zvcm09ZnVuY3Rpb24odCxzKXtpZih0PT09cyl0aHJvdyBuZXcgRXJyb3IoIklucHV0IGFuZCBvdXRwdXQgYnVmZmVycyBtdXN0IGJlIGRpZmZlcmVudCIpO3RoaXMuX291dD10LHRoaXMuX2RhdGE9cyx0aGlzLl9pbnY9MSx0aGlzLl90cmFuc2Zvcm00KCk7Zm9yKHZhciByPTA7cjx0Lmxlbmd0aDtyKyspdFtyXS89dGhpcy5zaXplO3RoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH0sdC5wcm90b3R5cGUuX3RyYW5zZm9ybTQ9ZnVuY3Rpb24oKXt2YXIgdCxzLHI9dGhpcy5fb3V0LGU9dGhpcy5fY3NpemUsaT0xPDx0aGlzLl93aWR0aCxvPWUvaTw8MSxuPXRoaXMuX2JpdHJldjtpZig0PT09bylmb3IodD0wLHM9MDt0PGU7dCs9byxzKyspe2NvbnN0IHI9bltzXTt0aGlzLl9zaW5nbGVUcmFuc2Zvcm0yKHQscixpKX1lbHNlIGZvcih0PTAscz0wO3Q8ZTt0Kz1vLHMrKyl7Y29uc3Qgcj1uW3NdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTQodCxyLGkpfXZhciBhPXRoaXMuX2ludj8tMToxLGY9dGhpcy50YWJsZTtmb3IoaT4+PTI7aT49MjtpPj49Mil7dmFyIGg9KG89ZS9pPDwxKT4+PjI7Zm9yKHQ9MDt0PGU7dCs9bylmb3IodmFyIF89dCtoLGw9dCx1PTA7bDxfO2wrPTIsdSs9aSl7Y29uc3QgdD1sLHM9dCtoLGU9cytoLGk9ZStoLG89clt0XSxuPXJbdCsxXSxfPXJbc10scD1yW3MrMV0sbT1yW2VdLGM9cltlKzFdLGQ9cltpXSx5PXJbaSsxXSx2PW8sVD1uLHc9Zlt1XSxnPWEqZlt1KzFdLGI9Xyp3LXAqZyxBPV8qZytwKncsej1mWzIqdV0sQj1hKmZbMip1KzFdLEM9bSp6LWMqQixTPW0qQitjKnosTT1mWzMqdV0sRj1hKmZbMyp1KzFdLHg9ZCpNLXkqRixFPWQqRit5Kk0sUj12K0MsTz1UK1MsST12LUMsUD1ULVMsVz1iK3gsaz1BK0UsRD1hKihiLXgpLEw9YSooQS1FKSxVPVIrVyxWPU8rayxqPVItVyxxPU8tayxHPUkrTCxIPVAtRCxKPUktTCxLPVArRDtyW3RdPVUsclt0KzFdPVYscltzXT1HLHJbcysxXT1ILHJbZV09aixyW2UrMV09cSxyW2ldPUoscltpKzFdPUt9fX0sdC5wcm90b3R5cGUuX3NpbmdsZVRyYW5zZm9ybTI9ZnVuY3Rpb24odCxzLHIpe2NvbnN0IGU9dGhpcy5fb3V0LGk9dGhpcy5fZGF0YSxvPWlbc10sbj1pW3MrMV0sYT1pW3Mrcl0sZj1pW3MrcisxXSxoPW8rYSxfPW4rZixsPW8tYSx1PW4tZjtlW3RdPWgsZVt0KzFdPV8sZVt0KzJdPWwsZVt0KzNdPXV9LHQucHJvdG90eXBlLl9zaW5nbGVUcmFuc2Zvcm00PWZ1bmN0aW9uKHQscyxyKXtjb25zdCBlPXRoaXMuX291dCxpPXRoaXMuX2RhdGEsbz10aGlzLl9pbnY/LTE6MSxuPTIqcixhPTMqcixmPWlbc10saD1pW3MrMV0sXz1pW3Mrcl0sbD1pW3MrcisxXSx1PWlbcytuXSxwPWlbcytuKzFdLG09aVtzK2FdLGM9aVtzK2ErMV0sZD1mK3UseT1oK3Asdj1mLXUsVD1oLXAsdz1fK20sZz1sK2MsYj1vKihfLW0pLEE9byoobC1jKSx6PWQrdyxCPXkrZyxDPXYrQSxTPVQtYixNPWQtdyxGPXktZyx4PXYtQSxFPVQrYjtlW3RdPXosZVt0KzFdPUIsZVt0KzJdPUMsZVt0KzNdPVMsZVt0KzRdPU0sZVt0KzVdPUYsZVt0KzZdPXgsZVt0KzddPUV9LHQucHJvdG90eXBlLl9yZWFsVHJhbnNmb3JtND1mdW5jdGlvbigpe3ZhciB0LHMscj10aGlzLl9vdXQsZT10aGlzLl9jc2l6ZSxpPTE8PHRoaXMuX3dpZHRoLG89ZS9pPDwxLG49dGhpcy5fYml0cmV2O2lmKDQ9PT1vKWZvcih0PTAscz0wO3Q8ZTt0Kz1vLHMrKyl7Y29uc3Qgcj1uW3NdO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm0yKHQscj4+PjEsaT4+PjEpfWVsc2UgZm9yKHQ9MCxzPTA7dDxlO3QrPW8scysrKXtjb25zdCByPW5bc107dGhpcy5fc2luZ2xlUmVhbFRyYW5zZm9ybTQodCxyPj4+MSxpPj4+MSl9dmFyIGE9dGhpcy5faW52Py0xOjEsZj10aGlzLnRhYmxlO2ZvcihpPj49MjtpPj0yO2k+Pj0yKXt2YXIgaD0obz1lL2k8PDEpPj4+MSxfPWg+Pj4xLGw9Xz4+PjE7Zm9yKHQ9MDt0PGU7dCs9bylmb3IodmFyIHU9MCxwPTA7dTw9bDt1Kz0yLHArPWkpe3ZhciBtPXQrdSxjPW0rXyxkPWMrXyx5PWQrXyx2PXJbbV0sVD1yW20rMV0sdz1yW2NdLGc9cltjKzFdLGI9cltkXSxBPXJbZCsxXSx6PXJbeV0sQj1yW3krMV0sQz12LFM9VCxNPWZbcF0sRj1hKmZbcCsxXSx4PXcqTS1nKkYsRT13KkYrZypNLFI9ZlsyKnBdLE89YSpmWzIqcCsxXSxJPWIqUi1BKk8sUD1iKk8rQSpSLFc9ZlszKnBdLGs9YSpmWzMqcCsxXSxEPXoqVy1CKmssTD16KmsrQipXLFU9QytJLFY9UytQLGo9Qy1JLHE9Uy1QLEc9eCtELEg9RStMLEo9YSooeC1EKSxLPWEqKEUtTCksTj1VK0csUT1WK0gsWD1qK0ssWT1xLUo7aWYoclttXT1OLHJbbSsxXT1RLHJbY109WCxyW2MrMV09WSwwIT09dSl7aWYodSE9PWwpe3ZhciBaPWorLWEqSywkPS1xKy1hKkosdHQ9VSstYSpHLHN0PS1WLSAtYSpILHJ0PXQrXy11LGV0PXQraC11O3JbcnRdPVoscltydCsxXT0kLHJbZXRdPXR0LHJbZXQrMV09c3R9fWVsc2V7dmFyIGl0PVUtRyxvdD1WLUg7cltkXT1pdCxyW2QrMV09b3R9fX19LHQucHJvdG90eXBlLl9zaW5nbGVSZWFsVHJhbnNmb3JtMj1mdW5jdGlvbih0LHMscil7Y29uc3QgZT10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89aVtzXSxuPWlbcytyXSxhPW8rbixmPW8tbjtlW3RdPWEsZVt0KzFdPTAsZVt0KzJdPWYsZVt0KzNdPTB9LHQucHJvdG90eXBlLl9zaW5nbGVSZWFsVHJhbnNmb3JtND1mdW5jdGlvbih0LHMscil7Y29uc3QgZT10aGlzLl9vdXQsaT10aGlzLl9kYXRhLG89dGhpcy5faW52Py0xOjEsbj0yKnIsYT0zKnIsZj1pW3NdLGg9aVtzK3JdLF89aVtzK25dLGw9aVtzK2FdLHU9ZitfLHA9Zi1fLG09aCtsLGM9byooaC1sKSxkPXUrbSx5PXAsdj0tYyxUPXUtbSx3PXAsZz1jO2VbdF09ZCxlW3QrMV09MCxlW3QrMl09eSxlW3QrM109dixlW3QrNF09VCxlW3QrNV09MCxlW3QrNl09dyxlW3QrN109Z30sZnVuY3Rpb24odCl7dC5zZW5kV2FzbU1vZHVsZT0ic2VuZC13YXNtLW1vZHVsZSIsdC53YXNtTW9kdWxlTG9hZGVkPSJ3YXNtLW1vZHVsZS1sb2FkZWQiLHQuaW5pdEZmdEFuYWx5c2VyPSJpbml0LWZmdC1hbmFseXNlciIsdC5zdGFydD0ic3RhcnQiLHQuc3RvcD0ic3RvcCIsdC5kYXRhQXZhaWxhYmxlPSJkYXRhLWF2YWlsYWJsZSJ9KHN8fChzPXt9KSk7Y29uc3QgZT10PT57Y29uc3Qgcz0yNTUqKHQtIC0xMDApKi4wMTQyODU3MTQyODU3MTQyODU7cmV0dXJuIE1hdGgubWF4KDB8cywwKX07Y2xhc3MgaSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntfc2FtcGxlc0NvdW50PTA7X2NvdW50PTA7X2ZpcnN0PSEwO19mZnRBbmFseXNlcjtfZmZ0U2l6ZTtfZmZ0T3V0cHV0O19sYXN0VHJhbnNmb3JtO19sYXN0VHJhbnNmb3JtQXNCeXRlcztfc2FtcGxlc0JldHdlZW5UcmFuc2Zvcm1zO19idWZmZXI7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiaXNSZWNvcmRpbmciLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucG9ydC5vbm1lc3NhZ2U9dD0+dGhpcy5vbm1lc3NhZ2UodC5kYXRhKX1vbm1lc3NhZ2UodCl7aWYodC50eXBlPT09cy5pbml0RmZ0QW5hbHlzZXIpe2NvbnN0e2ZmdFNpemU6cyxzYW1wbGVzQmV0d2VlblRyYW5zZm9ybXM6ZX09dDt0aGlzLl9mZnRBbmFseXNlcj1uZXcgcihzKSx0aGlzLl9mZnRPdXRwdXQ9dGhpcy5fZmZ0QW5hbHlzZXIuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5fbGFzdFRyYW5zZm9ybT1uZXcgRmxvYXQzMkFycmF5KHMvMiksdGhpcy5fbGFzdFRyYW5zZm9ybUFzQnl0ZXM9bmV3IFVpbnQ4QXJyYXkocy8yKSx0aGlzLl9mZnRTaXplPXMsdGhpcy5fc2FtcGxlc0JldHdlZW5UcmFuc2Zvcm1zPWUsdGhpcy5fYnVmZmVyPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5fZmZ0U2l6ZSksdGhpcy5faW5pdEJ1ZmZlcigpfX1faW5pdEJ1ZmZlcigpe2ZvcihsZXQgdD10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXM7dDx0aGlzLl9mZnRTaXplO3QrKyl0aGlzLl9idWZmZXJbdC10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXNdPXRoaXMuX2J1ZmZlclt0XTt0aGlzLl9zYW1wbGVzQ291bnQ9MH1faXNCdWZmZXJFbXB0eSgpe3JldHVybiAwPT09dGhpcy5fc2FtcGxlc0NvdW50fV9zaG91bGRUcmFuc2Zvcm1TYW1wbGVzKCl7cmV0dXJuIHRoaXMuX3NhbXBsZXNDb3VudD09PXRoaXMuX3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3Jtc31fYXBwZW5kVG9CdWZmZXIodCl7dGhpcy5fc2hvdWxkVHJhbnNmb3JtU2FtcGxlcygpJiZ0aGlzLl9mbHVzaCgpLHRoaXMuX2J1ZmZlclt0aGlzLl9mZnRTaXplLXRoaXMuX3NhbXBsZXNCZXR3ZWVuVHJhbnNmb3Jtcyt0aGlzLl9zYW1wbGVzQ291bnRdPXQsdGhpcy5fc2FtcGxlc0NvdW50Kz0xfV9kb0ZmdCgpe2xldCB0PXRoaXMuX2J1ZmZlcjt0aGlzLl9zYW1wbGVzQ291bnQ8dGhpcy5fc2FtcGxlc0JldHdlZW5UcmFuc2Zvcm1zJiYodD10LnNsaWNlKDAsdGhpcy5fZmZ0U2l6ZS10aGlzLl9zYW1wbGVzQmV0d2VlblRyYW5zZm9ybXMrdGhpcy5fc2FtcGxlc0NvdW50KSksdGhpcy5fZmZ0QW5hbHlzZXIucmVhbFRyYW5zZm9ybSh0aGlzLl9mZnRPdXRwdXQsdCk7Y29uc3Qgcz0xL3RoaXMuX2ZmdFNpemU7Zm9yKGxldCB0PTA7dDx0aGlzLl9sYXN0VHJhbnNmb3JtLmxlbmd0aDt0Kyspe2NvbnN0IGk9KHI9TWF0aC5hYnMoTWF0aC5oeXBvdCh0aGlzLl9mZnRPdXRwdXRbMip0XSx0aGlzLl9mZnRPdXRwdXRbMip0KzFdKSkqcywyMCpNYXRoLmxvZzEwKHIpKTt0aGlzLl9sYXN0VHJhbnNmb3JtW3RdPWksdGhpcy5fbGFzdFRyYW5zZm9ybUFzQnl0ZXNbdF09ZShpKX12YXIgcn1fZmx1c2goKXt0aGlzLl9kb0ZmdCgpLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZTpzLmRhdGFBdmFpbGFibGUsY3VycmVudFRpbWU6Y3VycmVudFRpbWUsZGF0YTp0aGlzLl9sYXN0VHJhbnNmb3JtQXNCeXRlc30pLHRoaXMuX2luaXRCdWZmZXIoKX1fcmVjb3JkaW5nU3RvcHBlZCgpe3RoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZTpzLnN0b3B9KX1wcm9jZXNzKHQscyxyKXtpZighdGhpcy5fYnVmZmVyKXJldHVybiEwO2NvbnN0IGU9ci5pc1JlY29yZGluZztmb3IobGV0IHM9MDtzPHQubGVuZ3RoO3MrKyl7Y29uc3Qgcj0xPT09ZVtzXSYmdFswXVswXTtpZihyfHx0aGlzLl9pc0J1ZmZlckVtcHR5KCl8fCh0aGlzLl9mbHVzaCgpLHRoaXMuX3JlY29yZGluZ1N0b3BwZWQoKSkscilmb3IobGV0IHM9MDtzPHRbMF1bMF0ubGVuZ3RoO3MrKyl0aGlzLl9hcHBlbmRUb0J1ZmZlcih0WzBdWzBdW3NdKX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoIkFkdmFuY2VkQW5hbHlzZXJQcm9jZXNzb3IiLGkpfSkpOwo=";

  class AdvancedAnalyserNode extends AudioWorkletNode {
      onData;
      fftSize;
      samplesBetweenTransforms;
      constructor(context, { onData, fftSize, samplesBetweenTransforms, }) {
          super(context, 'AdvancedAnalyserProcessor');
          this.port.onmessage = (event) => this.onmessage(event.data);
          this.onData = onData;
          this.fftSize = fftSize;
          this.samplesBetweenTransforms = samplesBetweenTransforms || fftSize;
          this.port.postMessage({
              type: MessageTypes.initFftAnalyser,
              sampleRate: this.context.sampleRate,
              fftSize: this.fftSize,
              samplesBetweenTransforms: this.samplesBetweenTransforms,
          });
      }
      onprocessorerror = (err) => {
          console.log(`An error from AudioWorkletProcessor.process() occurred: ${err}`);
      };
      onmessage(event) {
          if (event.type === MessageTypes.dataAvailable) {
              this.onData(event.data);
          }
      }
      start() {
          this.parameters.get('isRecording').setValueAtTime(1, this.context.currentTime);
      }
  }
  const createAdvancedAnalyserNode = async (context, options) => {
      const processorUrl = 'data:application/javascript;base64,' + processor;
      await context.audioWorklet.addModule(processorUrl);
      const advancedAnalyser = new AdvancedAnalyserNode(context, {
          ...options,
      });
      return advancedAnalyser;
  };

  exports.AdvancedAnalyserNode = AdvancedAnalyserNode;
  exports.createAdvancedAnalyserNode = createAdvancedAnalyserNode;

  Object.defineProperty(exports, '__esModule', { value: true });

}));
